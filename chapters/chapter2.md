# 第二章 - 率先躬行のサインポスト

Git とは何かということや Git を使う理由について説明してきました。
ここから Git の操作方法をコマンドラインインタフェース (CLI) のコマンドと Fork というソフトウェアを使用して説明します。
なお CLI を使った説明は「Git 初心者への道 - お仕事で困らないレベルまでググっとします。[^1]」や「今日からはじめる GitHub 〜 初心者が Git をインストールして、プルリクできるようになるまでを解説[^2]」といったページを見て、なんとなくの雰囲気を掴むのが良いでしょう。

Fork は以下の URL からダウンロードできます。Fork は Windows と macOS に対応しています。
`https://git-fork.com/`

## Git によるバージョン管理を始める `git init`

`git init` や `git clone` は任意のディレクトリで Git によるバージョン管理を始めるためのコマンドです。
いわば未来ガジェット研究所でタイムリープマシンが作られた状態にするものです。

Fork を起動した後、メニューの File から Init New Repository を選びます。

![メニューのFileからInit New Repositoryを選択している図](https://i.gyazo.com/0194555935fde3f096354652bbd49567.png)

Init New Repository を選ぶと、ディレクトリを選択する画面になるのですでにあるディレクトリもしくは新たにディレクトリを作って、そのディレクトリを選びます。
その状態で「フォルダーを選択」を押すと、選択したディレクトリ（フォルダ）が Git のリポジトリとして使えるようになります。

![リポジトリが作られた状態](https://i.gyazo.com/4f06f842f2579b411fccec39a8bbe184.png)

## すでにあるリモートリポジトリを使ってバージョン管理を始める `git clone`

すでにあるリモートリポジトリを自分の PC 上へコピーし Git によるバージョン管理を始められるようにします。
その前に、リモートリポジトリについて少し説明をします。リモートリポジトリとは、自分の PC 以外にあるリポジトリのことを指します。
「自分の PC 以外にあるリポジトリ」ですが「インターネット上や誰かの PC 上にあるリポジトリ」を指します。
他の章で「ネットワーク上のリポジトリ」という言葉がありましたが、これは「リモートリポジトリ」と同じ意味です。

このリモートリポジトリを自分の PC 上にコピーするのがこれから説明する手順です。
これでたとえばラボメンなど、他の人と共同でタイムリープマシンを使って作業できる体制が整います。

Fork を起動した後、メニューの File から Clone を選ぶと次の画面になります。

![Forkでクローンするときの画面](https://i.gyazo.com/dc1a89b72a6dd0486a4a5e7c946d8f40.png)

ここでリポジトリの URL とクローン先のディレクトリを選択し Clone を押すと選択したディレクトリにリポジトリが置かれます。

## 作業内容を記録する `git commit`

作業した内容をリポジトリに記録します。たとえるならば、Steins;Gate でストーリーを進めた後、セーブをするようなものです。

リポジトリ内にファイルを新しく作成した場合 Fork 上では Unstaged Changes という欄に表示されます。
ファイルがまだバージョン管理されてないことを示しています。

![ファイルがUnstaged Changesにある状態](https://i.gyazo.com/b547aee9bc275d48807c05e34bba57a1.png)

この状態で「Stage」ボタンを押すと Staged Changes という欄へファイルが移動します。
これでコミットするための準備が整うことになります。

![ファイルがStaged Changesへ移動した状態](https://i.gyazo.com/104c5dc7dc8010516112742013b8edfd.png)

ファイルを移動した状態で、画面の右下部にある「Enter commit subject」と書かれている場所に任意のメッセージを入力します。

![コミットメッセージを入力しているところ](https://i.gyazo.com/78d87e651f16232cf3993ec8dc85adea.png)

入力した後「Commit File」ボタンを押すと作業した内容がリポジトリに記録されます。

![コミットした後](https://i.gyazo.com/fa7fc133722fd2a5987620ad766d3a78.png)

なお右上のコミット一覧が表示されている場所に「master」という表記がありますが、これは「現時点でどのブランチにいるかを判別する情報」です。
つまり世界線の観測ができているということです。たとえるならばダイバージェンスメーターです。

## 作業内容を無かったことにする `git checkout -- <ファイル名>`

岡部は、ダルにメールを送信した後、秋葉原 UPX でタイムマシン理論についての講義を受けましたが、ディスカッションで紅莉栖に完全に論破されてしまいました。
岡部にとって、論破されたということは無くしたい事象ですが Git であればそれができます。

方法としては、作業内容を無かったことにするファイルを右クリックで選択し「Discard changes」を選択します。

![作業内容を無かったことにする](https://i.gyazo.com/9466853e76869d34ccee44d5a7809a87.png)

変更を本当に破棄していいか確認画面が表示されるので「Discard」を押します。
これで紅莉栖に論破されたという事実は無くなりました。

## 作業内容の差分を見る `git diff`

作業内容の差分を見ます。まゆりが死んだ理由を前回死んだ理由と比較し、そこから試行錯誤するようなものです。

Fork では特定の作業内容を選択した上で、右下のウィンドウのタブの中から「Changes」を選択すると、その作業内容の一つ前の作業内容と比べてどのような変更をしたのか見られます。

![Fork で作業内容の差分を見ている例](https://i.gyazo.com/95d9afe7b05355904715f3e6f833d681.png)

## ブランチの一覧を見たり、新たにブランチを作ったりする `git branch`

ブランチの一覧を見たり、新たにブランチを作ったりします。
「ブランチ」はたとえるならば「世界線」となり、ブランチを作るということは「世界線の観測」になります。

ではさっそくブランチを作る方法を説明していきます。
現在のブランチは「秋葉原が電気街となり、フェイリスのお父さんが生きている世界線」だとします。
「秋葉原が電気街となり、フェイリスのお父さんが生きている世界線」で鈴羽を引き止めるために岡部が D メールを送信しました。

ここまでの作業内容は次のようになります。

![新たなブランチを作る前](https://i.gyazo.com/d0ef35f87cc3b21c845a01f6567f3105.png)

ここから「鈴羽を引き止めるために D メールを送信した後の世界線」というブランチを作ります。
特定のコミットを選択した上で右クリックすると「Create New Branch」というメニューがあるのでこれをクリックします。
するとブランチ名を入力する画面が表示されるので「Branch name」のところに任意の名前を入力します。

![ブランチ名を決めているところ](https://i.gyazo.com/27de5c818129920fdc64628a3c4edf90.png)]

するとブランチができた状態になります。左メニューから作ったブランチを選択してクリックするとブランチを移動した状態になります。
世界線変動を起こしました。

![ブランチを作った後](https://i.gyazo.com/be50ac379e402205de4b65a0d14957bb.png)

## 作業内容を戻す `git revert`

作業内容を無かったことにします。ただしその無かったことにしたことはログに残ります。
「作業内容を無かったことにする」と似ていますが、違いとしては「すでにリポジトリに追加した作業内容も無かったことにできる」と「作業内容をリセットしたということが履歴に残る」があります。

これをたとえるならば、タイムリープのようなものです。

前に書いた「作業内容を無かったことにする」はリーディング・シュタイナーが働かないので記憶から無くなってしまいます。
しかしこの「作業内容を戻す」はリーディング・シュタイナーが働くため記憶に残ります。このようにたとえれば分かりやすいと思います。
話を戻しますが「鈴羽を引き止めた世界線」でいくつか作業をした結果、履歴が以下のようになりました。
最新の作業内容は「萌郁やラウンダー達の手によりまゆりが死んでしまった」となっています。

![鈴羽を引き止めた世界線でいくつか作業した後の状態](https://i.gyazo.com/2fd777aeb75c9e6163b4f9e900ac7632.png)

ここで最新の作業内容である「萌郁やラウンダー達の手によりまゆりが死んでしまった」という作業を無かったことにして、紅莉栖がタイムリープマシンを完成させたところにタイムリープします。
タイムリープするためには、戻したい作業内容を右クリックで選択し「Revert Commit」を選択した後にでてくる確認画面で「Revert」を押します。
これで履歴から「萌郁やラウンダー達の手によりまゆりが死んでしまった」というのが消えます。

![git revertをした後の状態](https://i.gyazo.com/ccc6e8267dd224ab62e6dc81e138b887.png)

## 作業内容を改変する `git rebase`

作業内容を改変します。

まゆりが死んだと書かれた複数の履歴を 1 つにまとめてみましょう。
まとめる対象のコミットの 1 つ前を右クリックで選択し「Interactive Rebase」から「Rebase '<ブランチ名>' to Here Interactively」を選びます。

![git rebase squash するべく親となるコミットを選択している状態](https://i.gyazo.com/12c19463b3c3df32132633429a35581c.png)

今回は 4 つの作業内容を対象としました。
ここから作業内容をまとめるには「Interactive Rebase」の画面で一番下のコミットを除い他コミットを fixup のモードにする必要があります。
初期状態だと全てのコミットが「Pick」になっていますが、「Pick」と書いている部分をクリックして「Fixup」にする必要があります。

![コミットの扱いをどうするかの一覧](https://i.gyazo.com/e295bc0797576013dbf34f9a26fc0373.png)

一番下のコミットはコミットメッセージを編集するために「Reword」とします。

![一番下のコミットをRewordにした状態](https://i.gyazo.com/55de371328f73a45fb22b8b42010f79b.png)

編集後に次のような上のコミット 3 つは「Fixup」が選択されて、一番下のコミットは「Reword」になっていれば問題ないです。
これで右下の「Rebase」を押します。

![全ての作業が終わった状態](https://i.gyazo.com/51c701d325b691134004a35575182dfc.png)

これで、まゆりが死んだと書かれた複数の履歴がまとめられました。

![git rebaseが完了した状態](https://i.gyazo.com/459a2232362f835559ef5fab0a98bd1a.png)

## ブランチを移動する `git checkout <ブランチ名>`

現在のブランチから別のブランチへ移動します。
あらためてですが、Git のブランチは「世界線」です。
D メールによる世界線変動は世界の状況に影響を及ぼしてましたが、Git ではそういった副作用が無く世界線の移動ができます。

ブランチ移動の方法は簡単です。
画面左端に表示されているブランチ一覧から、移動したいブランチの名前をクリックすることでブランチを移動できます。
以下の図では「鈴羽を引き止めた世界線」から「萌郁が IBN 5100 を手に入れた世界線」へ移動しています。

![ブランチを移動した後](https://i.gyazo.com/a7a9801e6aa31bc3a01010ca22084d79.png)

## リモートリポジトリに作業内容を送る `git push`

自分がした作業内容をリモートリポジトリに送ります。

岡部が紅莉栖にまゆりを助けるべくあれこれしてきたことを共有する感じです。
今まで、岡部はまゆりを助けるために何度もタイムリープをおこなって奮闘してきましたが、そのことを他のラボメンは知りません。
奮闘していることを知られないままタイムリープマシンを壊そうとしても、紅莉栖に止められるのはしかたないです。

なので、他のラボメン(今回の場合だと紅莉栖)に今まで岡部がしてきた作業内容を伝える必要があります。
左サイドバーの「Branches」からプッシュしたいブランチ名の上で右クリックをすると「Push '<ブランチ名>' to 'origin'」というメニューが出てくるのでそれを押します。
そうするとプッシュ時の確認画面が次のように表示されます。

![git push 前](https://i.gyazo.com/d739067838d1d99a066464683c1767d4.png)

プッシュが終わり、作業内容の一覧に「origin/ブランチ名」という文字が表示されるようになりました。
なお「origin」というのは、リモートリポジトリを指しています。
これで作業内容をリモートリポジトリに送り、紅莉栖に今までの作業内容が伝わりました。

![git push 後](https://i.gyazo.com/d564917b079610136615cf02d6e81940.png)

## リモートリポジトリの変更内容を自分の PC 上のリポジトリに取り込む `git pull`

他人がした変更をリモートリポジトリから取得し、自分の PC 上のリポジトリに取り込みます。

リモートリポジトリでは岡部以外にもラボメンが作業しています。
たとえば紅莉栖を見てみると、岡部の様子がおかしいのでタイムリープしてきたのか聞いていたり、マイフォークが欲しいと言ったことを記録していたりします。

![紅莉栖が作業している](https://i.gyazo.com/00c8a2c17105de29381ae225d33e1bbb.png)

これらの記録を手元に持ってきて作業ログを同期する必要があります。
では同期してみましょう。画面上部の「Pull」を押します。確認画面が表示されるので「Pull」を押します。

![pull してくるブランチを選んでいる状態](https://i.gyazo.com/986b730a9f58cbc75ee7286b5ce4687d.png)

これで自分の PC 上とリモートのリポジトリの作業内容が同期します。

![自分の PC 上のリポジトリとリモートリポジトリの同期をとった](https://i.gyazo.com/3d3262bcba628a8d72a1f8113aaaa8f0.png)

## 別のブランチでの作業内容を取り込む `git merge`

別ブランチの作業内容を現在のブランチに取り込みます。

「鈴羽を引き止めた世界線」というブランチで作業をした結果、鈴羽がタイムトラベルを失敗して「失敗した失敗した失敗した失敗した失敗した」と何度も書いた手紙を書き残して自殺してしまいました。
その結果、岡部は天王寺裕吾から鈴羽が書いた手紙を受け取ることになります。

![鈴羽を引き止めた世界線でいくつか作業をした例](https://i.gyazo.com/ddf90aa5a6d7b53db46f096b77821004.png)

それを無かったことにするため D メールを送って世界線を変動させ、鈴羽を引き止めないようにします。
その為には「秋葉原から萌えが消えた世界線」のブランチへ移動します。

![秋葉原から萌えが消えた世界線に移動した](https://i.gyazo.com/0981a13b7d0b14c281f58cdc8a22d095.png)

移動した後は鈴羽を引き止めるために D メールを送った状態が最新の状態となっています。
この状態から「鈴羽を引き止めた世界線」でしてきた作業を「秋葉原から萌えが消えた世界線」へ統合します。
方法としては、統合したいブランチの名前を右クリックして「Merge int '<統合したいブランチ名>'」を選択します。

![マージ対象のブランチを選択している状態](https://i.gyazo.com/b69d866cf7cddd8b08d0d8206add9ea4.png)

選択すると、確認ウィンドウが表示されるので「Merge」を押します。

![マージする際の確認メッセージ](https://i.gyazo.com/5ee29d9fe3d853412ec4d80cbba5ced1.png)

すると「秋葉原から萌えが消えた世界線」に「鈴羽を引き止めた世界線」でしてきた作業内容が統合された状態になります。
これで世界が収束しブランチ同士を統合できました。

![マージが完了した状態](https://i.gyazo.com/a73bef720f7bc58698ffb0eceaaa7a15.png)

[^1] https://gist.github.com/yatemmma/6486028
[^2] https://employment.en-japan.com/engineerhub/entry/2017/01/31/110000
